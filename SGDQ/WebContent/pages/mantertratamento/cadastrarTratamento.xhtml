<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    template="/templates/Template.xhtml">

<ui:define name="metadata"/>
    <ui:define name="content">
    	<script type="text/javascript"> 
				$(document).ready(function () {
					var btnAtualizaTratamentoDisable = false;	
					if (#{empty tratamentoController.prontuario.idProntuario or empty tratamentoController.selected.idtratamento or tratamentoController.selected.idtratamentostatus != 1})	
						btnAtualizaTratamentoDisable = true
					$("#button_atualizarTratamento").prop("disabled", btnAtualizaTratamentoDisable);

// 					$('#showDialogTerminoTratamento').click(function() {

// 						//alert ("Teste tudo desabilita: "+ #{empty tratamentoController.selected.dtsolicitacaotermino });

// 						var toggleDados = document.getElementById("formSolicitacaoTerminoTratamento:fieldset_dados_solicitcao_termino_tratamento_inclusao");
// 						var toggleSolicitacao = document.getElementById("formSolicitacaoTerminoTratamento:radio_status_do_tratamento_finaliza");

// 						if (#{empty tratamentoController.selected.dtsolicitacaotermino }){
// 							toggleSolicitacao.disabled = true;
// 							toggleDados.disabled = false;
// 						}else {
// 							toggleSolicitacao.disabled = false;
// 							toggleDados.disabled = true;
// 						}
// 	 				});	
				});
 		</script> 
    <h:body style="font-size:small;padding:0px;">
    	
    	 
    	 	<p:commandButton 
						id="button_pesquisarprontuario" 
						value="Pesquisar Prontuário" 
						action="/pages/manterprontuario/consultar?faces-redirect=true" 
						immediate="true" icon="ui-icon-arrowreturnthick-1-w" 
						disabled="#{not empty tratamentoController.prontuario.idProntuario}"/>
			<br/><br/> 	
			<p:fieldset id="fieldset_dados_prontuario" toggleable="true" legend="Prontuário: #{tratamentoController.prontuario.idProntuario}" 
				rendered="#{not empty tratamentoController.prontuario.idProntuario}">	 	
				<p:panelGrid id="prontuarioDados" >
					<p:row>
						<p:column>
							<p:outputLabel value="#{rotulo['prontuario.paciente.nome']}:" style="font-weight: bold"/>
						</p:column>
						<p:column  size="50" >
							<p:outputLabel value="#{tratamentoController.prontuario.idPaciente.idPessoa.nmPessoa}"/>
						</p:column>
						<p:column>
							<p:outputLabel value="#{rotulo['prontuario.paciente.cpf']}: " style="font-weight: bold"/>
						</p:column>
						<p:column size="50" >
							<p:outputLabel value="#{tratamentoController.prontuario.idPaciente.idPessoa.nuCPF}" />
						</p:column>
					</p:row>
					<p:row>	
						<p:column>
							<p:outputLabel value="Nome Responsável" style="font-weight: bold"/>
						</p:column>
						<p:column  size="50" >
							<p:outputLabel value="#{tratamentoController.prontuario.idPaciente.idResponsavel.idPessoa.nmPessoa}"/>
						</p:column>
						<p:column>
							<p:outputLabel value="#{rotulo['prontuario.paciente.telefone']}:" style="font-weight: bold"/>
						</p:column>
						<p:column size="50" >
							<p:outputLabel value="#{tratamentoController.prontuario.idPaciente.idPessoa.nuTelefone}" />
						</p:column>
						
					</p:row>
				</p:panelGrid>
			</p:fieldset>
				
				 	
			<h:form id="formTratamento" prependId="false" enctype="multipart/form-data" >
				<h:inputHidden value="#{tratamentoController.selected.idprontuario}" />
		    	<h:inputHidden value="#{tratamentoController.selected.idtratamento}" />
		    	<h:inputHidden value="#{tratamentoController.selected.icativo}" />
		    	<h:inputHidden value="#{tratamentoController.selected.icativo}" />
		    	<h:inputHidden value="#{tratamentoController.selected.idusuario}" />
		    	<h:inputHidden value="#{tratamentoController.selected.dtinclusao}">
		    		<f:convertDateTime pattern="yyyy-MM-dd" />
		    	</h:inputHidden>	
		    	<h:inputHidden value="#{tratamentoController.idFaseTratamentoAtual}"/>
<!-- 				<p:messages id="mensagens" closable="true"/> -->
				<br/>	
				<p:fieldset  id="fieldset_dados_do_tratamento" legend="#{rotulo['tratamento.dados_do_tratamento']}" >
					
					 <p:panelGrid>
					    	<p:row >
					    		<p:column>
					  				<p:outputLabel value="#{rotulo['tratamento.data_de_inclusao']}:" style="font-weight: bold"/>
					  			</p:column>
					  			<p:column>
					  				<h:outputText  value="#{tratamentoController.selected.dtinclusao}" >
										<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
									</h:outputText >
					  	    	</p:column>
					    		<p:column>
					  				<p:outputLabel value="#{rotulo['tratamento.usuario_responsavel']}:" style="font-weight: bold"/>
					  			</p:column>
					  			<p:column>
					  				<p:outputLabel value="#{tratamentoController.usuario.tbpessoa.nmPessoa}" />  
					        	</p:column>
					        </p:row>
					   </p:panelGrid>     
					   <p:panelGrid id="tratamento" >
					    	<p:row>
					    		<p:column>
					  				<p:outputLabel value="#{rotulo['tratamento.tipo_de_tratamento']}:" />
					  			</p:column>
					  			<p:column>
					  				<p:selectOneRadio 
					  					id="radio_tipo_de_tratamento" 
					  					value="#{tratamentoController.selected.idtratamentotipo}" 
					  					required="true" 
					  					requiredMessage="Tipo de tratamento deve ser informado.">  
							            <f:selectItem itemLabel="Ambulatorial" itemValue="1" />  
							            <f:selectItem itemLabel="Internação" itemValue="2" />  
							        </p:selectOneRadio>
					        	</p:column>
					        </p:row>
					  		<p:row>
					  			<p:column>
					  				<p:outputLabel value="#{rotulo['tratamento.status_do_tratamento']}:" />
					  			</p:column>  
					  			<p:column>
					  				<p:selectOneRadio 
					  						id="radio_status_do_tratamento" 
					  						value="#{tratamentoController.selected.idtratamentostatus}" 
					  						required="true" requiredMessage="Status do tratamento deve ser informado."
					  						>  
							            <f:selectItem itemLabel="Em andamento" itemValue="1" checked="checked"/>  
							            <f:selectItem itemLabel="Interrompido" itemValue="2" itemDisabled="true"/>
							            <f:selectItem itemLabel="Concluido" itemValue="3" itemDisabled="true"/>
							            <f:selectItem itemLabel="Desistência" itemValue="4" itemDisabled="true"/>
							            <f:selectItem itemLabel="Afastado" itemValue="5" itemDisabled="true"/>  
							        </p:selectOneRadio>
					  				
					  			</p:column>
					  		</p:row>
					  		<p:row>
					  			<p:column>
					  				<p:outputLabel value="#{rotulo['tratamento.motivo_do_status']}:" />
					  			</p:column>  
					  			<p:column>
					  				<p:inputTextarea 
					  					id="input_motivo_do_status" 
					  					value="#{tratamentoController.selected.dstratamentostatusmotivo}" 
					  					required="true" 
					  					requiredMessage="#{mensagem['sistema.descricao.required']}" cols="60"/>
					  			</p:column>
							</p:row>
					    	
					    </p:panelGrid>
				</p:fieldset>
				<br/>			
				 <p:dataTable id="dataTable_exame_medico" var="exame" 
				 		value="#{exameController.exameList}" 
				 		editable="false" widgetVar="examesTable"
				 		rendered="#{not empty exameController.exameList}">  
 
			        <f:facet name="header">  
			            Exames  
			        </f:facet>  
			  
					<p:column headerText="Nome do Exame" style="width:40%">  
<!-- 			               <p:cellEditor>   -->
<!-- 			                   <f:facet name="output"><h:outputText value="#{exame.dsexame}" /></f:facet>   -->
<!-- 			                   <f:facet name="input"><p:inputText value="#{exame.dsexame}" style="width:96%"/></f:facet>   -->
<!-- 			               </p:cellEditor> -->
		               <p:inputText id="input_exame_nome" value="#{exame.nmexame}">
		               		<p:ajax event="blur" partialSubmit="false" listener="#{exameController.onBlur}" update="@this" execute="@this" process="@this" imediate="true"/>
		               		<f:attribute name="input_exame_nome_atributo" value="#{exame.nmexame}" />
		               </p:inputText>	  
		          	</p:column>		
		          	<p:column headerText="Data Realização do Exame" style="width:25%">  
<!-- 			               <p:cellEditor>   -->
<!-- 			                   <f:facet name="output"><h:outputText value="#{exame.dtexame}" /></f:facet>   -->
<!-- 			                   <f:facet name="input"><p:inputText value="#{exame.dtexame}" style="width:96%"/></f:facet>   -->
<!-- 			               </p:cellEditor> -->
<!-- 			               <p:inputText id="input_exame_data" value="#{exame.dtexame}"> -->
						   <p:inputMask value="#{exame.dtexame}" mask="99/99/9999" converter="converterCampoData">	
		               			<p:ajax event="blur" partialSubmit="false" listener="#{exameController.onBlur}" update="@this" execute="@this" process="@this" imediate="true"/>
 			               </p:inputMask>
<!-- 						   </p:inputText>     -->
		          	</p:column>	
		          	<p:column headerText="Resultado dos Exames" style="width:25%">  
		               <p:inputTextarea
			  					id="input_tratamento_resultado_exames" 
			  					value="#{exame.dsresultado}" 
				  					cols="60"
				  					rows="1" >
		               		<p:ajax event="blur" partialSubmit="false" listener="#{exameController.onBlur}" update="@this" execute="@this" process="@this" imediate="true"/>
		               </p:inputTextarea>    
		          	</p:column>	
		          	
<!-- 			          	<p:ajax event="cellEdit" listener="#{exameController.onEdit}" update=":formTratamento" process="@this"/>	 -->
				</p:dataTable>		
				<br/>
				
				<p:fieldset id="fieldset_dados_fasetratamento"
					toggleable="true" legend="Fase Tratamento" 
					rendered="#{not empty tratamentoController.faseTratamento}">	 	
					<ui:repeat var="varFaseTratamento" value="#{tratamentoController.faseTratamento}" varStatus="status">
					
						<p:panelGrid>
							<p:row>
								<p:column>
									<p:outputLabel value="Fase: " style="font-weight: bold"/>
								</p:column>
								<p:column size="50" >
									<p:outputLabel value="#{varFaseTratamento.idfase}" />
								</p:column>
								<p:column>
									<p:outputLabel value="Inicio: " style="font-weight: bold"/>
								</p:column>
								<p:column size="50" >
									<h:outputText  value="#{varFaseTratamento.dtfasetratamentonicio}" >
										<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
									</h:outputText >
								</p:column>
								<p:column>
									<p:outputLabel value="Fim: " style="font-weight: bold"/>
								</p:column>
								<p:column size="50" >
										<h:outputText  value="#{empty varFaseTratamento.dtfasetratamentofim ? 'Fase Atual &nbsp;&nbsp;' : varFaseTratamento.dtfasetratamentofim}" >
											<f:convertDateTime type="date" pattern="dd-MM-yyyy"/>
										</h:outputText >
								</p:column>
								<p:column>
									<p:outputLabel value="Justificativa: " style="font-weight: bold"/>
								</p:column>
								<p:column size="50" >
										<h:outputText  value="#{varFaseTratamento.dsmotivofasetratamento}" />
								</p:column>
							</p:row>
						</p:panelGrid>
					</ui:repeat>
				</p:fieldset>
				<br/>
				
				
				<div class="buttons">
					<p:commandButton 
						id="button_salvarTratamento"      
						value="#{rotulo['generico.salvar']}" 
						actionListener="#{tratamentoController.create}" 
					  	update="formTratamento" icon="ui-icon-check"
					  	disabled="#{not empty tratamentoController.selected.idtratamento}" 
					  	/>  
<!-- 						readonly="#{empty tratamentoController.prontuario.idProntuario or not empty tratamentoController.selected.idtratamento}" -->
					
					<p:commandButton 
						id="button_atualizarTratamento"      
						value="#{rotulo['generico.atualizar']}" 
						action="#{tratamentoController.update}" 
						update="formTratamento" icon="ui-icon-check" >
					</p:commandButton>						    	
					<p:commandButton 
						id="button_voltar" 
						value="#{rotulo['generico.voltar']}" 
						action="/pages/mantertratamento/consultar?faces-redirect=true" 
						immediate="true" icon="ui-icon-arrowreturnthick-1-w" />
				
					<p:commandButton 
						id="showDialogFaseTratamento" 
						icon="ui-icon-newwin" 
						type="button" 
						value="Incluir Fase" 
						onclick="dialogFaseTratamento.show()" 
						disabled="#{empty tratamentoController.selected.idtratamento or tratamentoController.selected.idtratamentostatus != 1 or tratamentoController.selected.idtratamentotipo == 1}"/>   	
					  	
<!-- 					<p:commandButton  -->
<!-- 					 	value="Incluir Exame" icon="ui-icon-newwin"  -->
<!-- 					 	update="formTratamento"   -->
<!-- 					 	oncomplete="dialog.show();" -->
<!-- 					 	disabled="#{empty tratamentoController.selected.idtratamento or tratamentoController.selected.idtratamentostatus != 1}"/> -->
					
					<p:commandButton 
						id="showDialogTerminoTratamento" 
					 	value="Solicitar Termino" icon="ui-icon-newwin" 
					 	imediate="true"
					 	oncomplete="dialogTerminoTratamento.show()"
					 	disabled="#{(empty tratamentoController.selected.idtratamento or tratamentoController.selected.idtratamentostatus != 1)}"
					 	/> 	
					 	 		
				</div>
			</h:form>  
<!-- 			****************** Dialogs ******************* -->
<!-- 				<p:dialog id="dlgProntuario" header="Prontuário" widgetVar="dialog" resizable="true" showEffect="slide" width="600" > -->
<!-- 					<p:panelGrid id="infosProntuario" columns="4" cellpadding="5"  style="font-size:small;padding:0px;"> -->
<!-- 						<ui:include src="/pages/manterprontuario/unitConsultarProntuario.xhtml" />  -->
<!-- 					</p:panelGrid> -->
<!-- 				</p:dialog> -->
				
				<p:dialog header="Inclusão Fase Tratamento" widgetVar="dialogFaseTratamento" resizable="true" width="500">  
				    <h:form id="formInclusaoFaseTratamento">
				    	<h:inputHidden value="#{tratamentoController.selected.idtratamento}" />
				    	<p:panelGrid> 
				        	<p:row> 
								<p:column>
					  				<p:outputLabel value="#{rotulo['tratamento.data_de_inclusao']}:" style="font-weight: bold"/>
					  			</p:column>
					  			<p:column>
					  				<h:outputText  value="#{tratamentoController.selected.dtinclusao}" >
										<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
									</h:outputText >
					  	    	</p:column>
					    	</p:row> 
					    	<p:row> 
					    		<p:column>
					  				<p:outputLabel value="#{rotulo['tratamento.usuario_responsavel']}:" style="font-weight: bold"/>
					  			</p:column>
					  			<p:column>
					  				<p:outputLabel value="#{tratamentoController.usuario.tbpessoa.nmPessoa}" />  
					        	</p:column>
					        </p:row>
				        	<p:row> 
								<p:column colspan="2">
									<p:outputLabel value="Justificativa: "/>
								</p:column>
							</p:row>
							<p:row>	
								<p:column colspan="2">
									<p:inputTextarea 
					  					id="input_motivo_do_status"
					  					value="#{tratamentoController.dsmotivofasetratamento}" 
					  					cols="60" 	/>
								</p:column> 
				        	</p:row>
				        </p:panelGrid>  
				  
				        <p:commandButton 
						 	value="Incluir" icon="ui-icon-disk" 
						 	update=":formTratamento"  
						 	oncomplete="dialogFaseTratamento.hide()"
						 	actionListener="#{tratamentoController.addFaseTratamento}"/> 
				        
				        <p:commandButton 
					 	value="Fechar" icon="ui-icon-close" 
					 	oncomplete="dialogFaseTratamento.hide()"/>       
				    </h:form>  
				</p:dialog> 
			
			
			<!-- 		************** Solicitacao termino ***************** -->	
				<p:dialog header="Finalizar Tratamento" widgetVar="dialogTerminoTratamento" id="dlSolicitaTerminoTratamento" resizable="false" width="640" appendToBody="true">  
				    <h:form id="formSolicitacaoTerminoTratamento">
				    	<h:inputHidden value="#{tratamentoController.selected.idtratamento}" />
<!-- 				    	<p:fieldset id="fieldset_dados_solicitcao_termino_tratamento_inclusao" toggleable="true" legend="Dados">	 -->
<!-- 					    	<p:panelGrid>  -->
<!-- 					        	<p:row>  -->
<!-- 									<p:column> -->
<!-- 						  				<p:outputLabel value="#{rotulo['tratamento.data_de_inclusao']}:" style="font-weight: bold"/> -->
<!-- 						  			</p:column> -->
<!-- 						  			<p:column> -->
<!-- 						  				<h:outputText  value="#{tratamentoController.selected.dtinclusao}" > -->
<!-- 											<f:convertDateTime type="date" pattern="dd/MM/yyyy"/> -->
<!-- 										</h:outputText > -->
<!-- 						  	    	</p:column> -->
<!-- 						    	</p:row>  -->
<!-- 						    	<p:row>  -->
<!-- 						    		<p:column> -->
<!-- 						  				<p:outputLabel value="#{rotulo['tratamento.usuario_responsavel']}:" style="font-weight: bold"/> -->
<!-- 						  			</p:column> -->
<!-- 						  			<p:column> -->
<!-- 						  				<p:outputLabel value="#{tratamentoController.usuario.tbpessoa.nmPessoa}" />   -->
<!-- 						        	</p:column> -->
<!-- 						        </p:row> -->
<!-- 					        	<p:row>  -->
<!-- 									<p:column colspan="2"> -->
<!-- 										<p:outputLabel value="Justificativa solicitação termino: "/> -->
<!-- 									</p:column> -->
<!-- 								</p:row> -->
<!-- 								<p:row>	 -->
<!-- 									<p:column colspan="2"> -->
<!-- 										<p:inputTextarea  -->
<!-- 						  					id="input_motivo_solicitacao_termino" -->
<!-- 						  					value="#{tratamentoController.dsmotivofasetratamento}"  -->
<!-- 						  					cols="60"  -->
<!-- 						  					/> -->
<!-- 									</p:column>  -->
<!-- 					        	</p:row> -->
<!-- 					        </p:panelGrid> -->
<!-- 				        </p:fieldset> -->
				        <p:fieldset id="fieldset_dados_solicitcao_termino_tratamento" legend="Solicitação" >	
							<p:panelGrid>
								<p:row>
									<p:column>
										<p:outputLabel value="Incluido: " style="font-weight: bold"/>
									</p:column>
									<p:column size="50" >
										<h:outputText value="#{tratamentoController.selected.dtsolicitacaotermino}" >
											<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
										</h:outputText >
									</p:column>
									<p:column>
										<p:outputLabel value="Responsável: " style="font-weight: bold"/>
									</p:column>
									<p:column size="50" >
										<h:outputText  value="#{tratamentoController.selected.idusuariosolicitacaotermino}" />
									</p:column>
								</p:row>
								<p:row>
									<p:column colspan="4">
										<p:outputLabel value="Solicitação de termino de tratamento: " style="font-weight: bold"/>
									</p:column>
								</p:row>
								<p:row>
									<p:column colspan="4">
											<h:outputText  value="#{tratamentoController.selected.dssolicitacaotermino}" />
									</p:column>
								</p:row>
								<p:row> 
						    		<p:column colspan="4">
										<p:selectOneRadio 
						  						id="radio_status_do_tratamento_finaliza" 
						  						value="#{tratamentoController.idTratamentoStatus}" 
						  						required="true" requiredMessage="Status do tratamento deve ser informado na finalização do tratamento.">  
								        <f:selectItem itemLabel="Interrompido" itemValue="2" />
							            <f:selectItem itemLabel="Concluido" itemValue="3" />
							            <f:selectItem itemLabel="Desistência" itemValue="4" />
							            <f:selectItem itemLabel="Afastado" itemValue="5" />   
								        </p:selectOneRadio>
									</p:column>
								</p:row>
								<p:row>
									<p:column colspan="4" style="text-align: center;">
										<h:commandLink action="#{tratamentoController.finalizaTratamento}">
											<p:graphicImage value="/resources/images/finalizarTratamento.png"/>
										</h:commandLink>
									</p:column>
								</p:row>
							</p:panelGrid>
						</p:fieldset>  


					    <p:commandButton 
							 	value="Fechar" icon="ui-icon-close" 
							 	oncomplete="dialogTerminoTratamento.hide()"/>       
						   	
				    </h:form>  
				</p:dialog>  
				
		</h:body>
	</ui:define>
</ui:composition>
